diff --git a/CMakeLists.txt b/CMakeLists.txt
index 16d89ff..80c3876 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -775,9 +775,9 @@ ENDIF(PCRE_BUILD_PCREGREP)
 IF(PCRE_BUILD_TESTS)
   ENABLE_TESTING()
 
-  SET(PCRETEST_SOURCES pcretest.c)
+  SET(PCRETEST_SOURCES 240817_test_latestPCRE1.c)
   IF(PCRE_BUILD_PCRE8)
-    LIST(APPEND PCRETEST_SOURCES pcre_printint.c)
+    LIST(APPEND PCRETEST_SOURCES getopt.c)
   ENDIF(PCRE_BUILD_PCRE8)
   IF(PCRE_BUILD_PCRE16)
     LIST(APPEND PCRETEST_SOURCES pcre16_printint.c)
@@ -798,6 +798,9 @@ IF(PCRE_BUILD_TESTS)
     LIST(APPEND PCRETEST_LIBS pcre32)
   ENDIF(PCRE_BUILD_PCRE32)
   TARGET_LINK_LIBRARIES(pcretest ${PCRETEST_LIBS})
+  IF(NOT BUILD_SHARED_LIBS)
+    SET_TARGET_PROPERTIES(pcretest PROPERTIES COMPILE_FLAGS "-DPCRE_STATIC")
+  ENDIF()
 
   IF(PCRE_SUPPORT_JIT)
     ADD_EXECUTABLE(pcre_jit_test pcre_jit_test.c)
